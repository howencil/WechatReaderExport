# Chrome插件开发说明

## 当前状态
✅ 项目基础框架已完成
✅ Webpack构建配置完成  
✅ Manifest V3配置完成
✅ 智能页面检测功能完成
✅ 笔记数据提取功能完成
✅ 多格式导出功能完成
✅ 完整用户界面完成

## 功能特性

### 🎯 智能页面识别
- 自动检测微信读书页面类型（阅读页、笔记页、详情页等）
- 提取书籍基础信息（标题、作者、封面）
- 统计页面笔记数量
- 智能判断页面是否支持导出

### 📝 强大的笔记提取
- 支持10多种CSS选择器策略
- 智能模式匹配识别笔记元素
- 提取完整数据：原文摘录、个人笔记、章节、时间、类型
- 处理动态加载和分页内容
- 支持多种笔记类型（高亮、想法、书签）

### 📄 多格式导出
- **Markdown格式**: 按章节组织，包含引用格式
- **JSON格式**: 完整结构化数据，便于程序处理
- **TXT格式**: 纯文本格式，最佳兼容性
- 自动生成带时间戳的文件名
- 使用Chrome Downloads API下载文件

### 💫 优秀用户体验
- 实时状态检测和反馈
- 智能错误处理和重试机制
- 页面内状态提示动画
- URL变化自动重新检测
- 刷新按钮手动更新状态

## 文件结构
```
dist/
├── manifest.json     # 插件配置文件 (1.14KB)
├── background.js     # 后台服务工作线程 (338B)
├── content.js        # 内容脚本 (11KB - 包含检测和提取逻辑)
├── popup.html        # 弹窗界面 (1.36KB)
├── popup.js          # 弹窗脚本 (6.59KB - 包含导出功能)
└── icons/           # 插件图标
    ├── icon.svg     # SVG源文件
    └── README.md    # 图标转换说明
```

## 加载插件步骤

### 1. 开发者模式
1. 打开Chrome浏览器
2. 访问 chrome://extensions/
3. 开启"开发者模式"开关

### 2. 加载插件
1. 点击"加载已解压的扩展程序"
2. 选择项目的 `dist` 文件夹
3. 插件将出现在扩展程序列表中

### 3. 测试功能
1. 访问微信读书网站 (weread.qq.com)
2. 进入任意书籍的笔记页面
3. 点击浏览器工具栏中的插件图标
4. 查看页面检测结果和笔记统计
5. 选择导出格式并点击"导出笔记"

## 支持的页面类型

### ✅ 完全支持（可导出）
- **阅读页面** (`/web/reader/`) - 可导出当前阅读的笔记
- **笔记页面** (`/web/book/?type=note`) - 专门的笔记查看页面

### ⚠️ 部分支持（仅检测）
- **书籍详情页** (`/web/bookDetail/`) - 显示书籍信息，提示进入笔记页面
- **书架页面** (`/web/shelf`) - 提示选择具体书籍

### ❌ 不支持
- **书评页面** (`/web/review/`) - 不包含个人笔记内容
- **其他页面** - 非微信读书相关页面

## 使用流程

### 标准导出流程
1. **打开微信读书** → 访问 weread.qq.com
2. **进入笔记页面** → 选择书籍并进入笔记查看页面
3. **打开插件** → 点击浏览器工具栏中的插件图标
4. **检查状态** → 确认显示绿色成功状态和笔记数量
5. **选择格式** → 从下拉菜单选择导出格式
6. **开始导出** → 点击"导出笔记"按钮
7. **保存文件** → 在弹出的保存对话框中选择位置

### 故障排除
- **检测失败**: 点击刷新按钮（🔄）重新检测
- **连接失败**: 刷新微信读书页面后重新打开插件
- **没有笔记**: 确认当前页面确实包含笔记内容
- **下载失败**: 检查浏览器下载权限设置

## 技术特性

### 数据提取策略
1. **优先级选择器**: 使用常见的笔记CSS类名
2. **智能模式匹配**: 基于内容特征识别笔记元素
3. **多重验证**: 验证文本长度、时间信息等特征
4. **容错处理**: 处理各种异常情况和边界条件

### 导出文件格式

#### Markdown (.md)
```markdown
# 书名

**作者:** 作者名称
**导出时间:** 2025-09-07 20:30:15
**笔记数量:** 10 条

---

## 第一章

### 笔记 1
> 这是原文摘录内容

**我的想法:** 这是我的个人笔记

*创建时间: 2025-09-07 15:30:00*
```

#### JSON (.json)
```json
{
  "bookInfo": {
    "bookId": "123456",
    "title": "书名",
    "author": "作者"
  },
  "notes": [...],
  "exportTime": "2025-09-07T12:30:00.000Z",
  "totalCount": 10
}
```

## 注意事项
- 图标文件需要手动转换PNG格式
- 开发时修改代码后需要重新构建 (`npm run build`)
- 在扩展管理页面点击刷新按钮更新插件
- 确保微信读书页面完全加载后再使用插件

## 下一步开发
- [ ] 添加图标PNG文件
- [ ] 优化笔记识别算法
- [ ] 支持更多导出格式（PDF、EPUB等）
- [ ] 添加笔记筛选和搜索功能
- [ ] 实现批量导出多本书籍